<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Spearman Correlation Heat Map with Correlation Coefficients and Significance Levels in R - Proven Inconclusive</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://proven-inconclusive.com/blog/spearman_correlation_heat_map_with_correlation_coefficient_and_significance_in_r.html">

        <meta name="author" content="Hinrich B. Winther" />
        <meta name="keywords" content=""scientific writing","R"" />
        <meta name="description" content="Figure 1: Spearman correlation heat map with correlation coefficient and significance levels based on the mtcars data set. In a recent paper we included data from a survey we conducted. During the publication process, one of the reviewers asked for a more in depth statistical analysis of the data set ..." />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://proven-inconclusive.com/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://proven-inconclusive.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://proven-inconclusive.com/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://proven-inconclusive.com/theme/css/style.css" type="text/css"/>
        <link href="http://proven-inconclusive.com/css/style.css" rel="stylesheet">

        <link href="http://proven-inconclusive.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Proven Inconclusive ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://proven-inconclusive.com/" class="navbar-brand">
Proven Inconclusive            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://proven-inconclusive.com/pages/about.html">
                             About Me
                          </a></li>
                         <li><a href="http://proven-inconclusive.com/pages/projects.html">
                             Projects
                          </a></li>
                         <li><a href="http://proven-inconclusive.com/pages/publications.html">
                             Publications
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://proven-inconclusive.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://proven-inconclusive.com/blog/spearman_correlation_heat_map_with_correlation_coefficient_and_significance_in_r.html"
                       rel="bookmark"
                       title="Permalink to Spearman Correlation Heat Map with Correlation Coefficients and Significance Levels in R">
                        Spearman Correlation Heat Map with Correlation Coefficients and Significance Levels in R
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-10-24T00:00:00+02:00"> Fri 24 October 2014</time>
    </span>
            <span class="label label-default">By</span>
            <a href="http://proven-inconclusive.com/author/hinrich-b-winther.html"><i class="fa fa-user"></i> Hinrich B. Winther</a>



<span class="label label-default">Tags</span>
	<a href="http://proven-inconclusive.com/tags/scientific-writing.html">"scientific writing"</a>
        /
	<a href="http://proven-inconclusive.com/tags/r.html">"R"</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <figure>
<img src="http://proven-inconclusive.com/images/R/spearman_correlation_heatmap_mtcars.svg" alt="Figure 1: Spearman correlation heat map with correlation coefficient and significance levels based on the mtcars data set." /><figcaption>Figure 1: Spearman correlation heat map with correlation coefficient and significance levels based on the mtcars data set.</figcaption>
</figure>
<p>In a recent paper we included data from a survey we conducted. During the publication process, one of the reviewers asked for a more in depth statistical analysis of the data set. He (she?) explicitly expressed a special interest in correlating the variables of the survey in order to spot any interesting correlations. This posed a number of problems:</p>
<ol type="1">
<li><p>The data set has 35 variables. This translates into a huge correlation matrix.</p></li>
<li><p>There are many ways to correlate variables. In my field the <a href="http://en.wikipedia.org/wiki/Pearson_product-moment_correlation_coefficient">Pearson product-moment correlation coefficient (Pearson's r)</a> and the <a href="http://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient">Spearman's rank correlation coefficient (Spearman's rho)</a> are the most common ones. Which one should I choose and why?</p></li>
<li><p>Correlations by themselves are not very useful. You, most likely, want to have at least some information about the statistical significance of the correlation.</p></li>
</ol>
<h3 id="the-data-set">The Data Set</h3>
<p>For the sake of demonstration we will use the <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/mtcars.html">mtcars</a> data set, provided by the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/00Index.html">stats</a> package. The data set includes 11 variables with 32 observations, hence rendering the task a bit more manageable.</p>
<table>
<caption>Table 1: The first five (of 32) observations of the mtcars data set.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">disp</th>
<th style="text-align: right;">hp</th>
<th style="text-align: right;">drat</th>
<th style="text-align: right;">wt</th>
<th style="text-align: right;">qsec</th>
<th style="text-align: right;">vs</th>
<th style="text-align: right;">am</th>
<th style="text-align: right;">gear</th>
<th style="text-align: right;">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mazda RX4</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.620</td>
<td style="text-align: right;">16.46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mazda RX4 Wag</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.875</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Datsun 710</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">108.0</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">2.320</td>
<td style="text-align: right;">18.61</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hornet 4 Drive</td>
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">258.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.215</td>
<td style="text-align: right;">19.44</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hornet Sportabout</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
<table>
<caption>Table 2: Description of the variable labels of the mtcars data set.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">axis</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mpg</td>
<td style="text-align: left;">Miles/(US) gallon</td>
</tr>
<tr class="even">
<td style="text-align: left;">cyl</td>
<td style="text-align: left;">Number of cylinders</td>
</tr>
<tr class="odd">
<td style="text-align: left;">disp</td>
<td style="text-align: left;">Displacement (cu.in.)</td>
</tr>
<tr class="even">
<td style="text-align: left;">hp</td>
<td style="text-align: left;">Gross horsepower</td>
</tr>
<tr class="odd">
<td style="text-align: left;">drat</td>
<td style="text-align: left;">Rear axle ratio</td>
</tr>
<tr class="even">
<td style="text-align: left;">wt</td>
<td style="text-align: left;">Weight (lb/1000)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">qsec</td>
<td style="text-align: left;">1/4 mile time</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs</td>
<td style="text-align: left;">V/S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">am</td>
<td style="text-align: left;">Transmission (0 = automatic, 1 = manual)</td>
</tr>
<tr class="even">
<td style="text-align: left;">gear</td>
<td style="text-align: left;">Number of forward gears</td>
</tr>
<tr class="odd">
<td style="text-align: left;">carb</td>
<td style="text-align: left;">Number of carburetors</td>
</tr>
</tbody>
</table>
<h3 id="choosing-a-suitable-correlation-algorithm">Choosing a Suitable Correlation Algorithm</h3>
<p>As most papers in my field use either Pearson's r or Spearman's rho I began my research there. As it turns out, there are two types of algorithms: parametric and non-parametric. Parametric algorithms depend on some assumptions about the data set. In case of Pearson's r you need to know about the distribution, scaling and dependency of the variables of the data set.</p>
<p>Spearman's rho, on the other hand, is a non-parametric algorithm. It compares two ranked variables of either <a href="http://en.wikipedia.org/wiki/Level_of_measurement">ordinal, interval or ratio</a> type and describes how well they can be described using a monotonic function. No further assumptions on the data set are necessary which is handy if you do not know too much about the distribution of your data.</p>
<h3 id="lets-get-started">Let's Get Started!</h3>
<p><a href="http://www.r-project.org">R</a>, a statistical computing programming language, is being used for the statistical analysis with some additional libraries: <a href="http://ggplot2.org">ggplot2</a> for plotting, <a href="http://biostat.mc.vanderbilt.edu/wiki/Main/Hmisc">Hmisc</a> to create a correlation matrix, <a href="https://github.com/hadley/reshape">reshape2</a> to meld the data frame as well as <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/00Index.html">stats</a> to provide the <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/mtcars.html">mtcars</a> data set.</p>
<pre class="sourceCode R"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(reshape2)
<span class="kw">library</span>(Hmisc)
<span class="kw">library</span>(stats)</code></pre>
<p>The first thing is to calculate the correlation of the individual variables to another. As we have our data already in a data frame, merely a call of the rcorr function of the Hmisc library is necessary. This creates a new list with two entries: ”r” the correlation coefficients and ”P” the significance levels.</p>
<blockquote>
<p>rcorr Computes a matrix of Pearson's r or Spearman's rho rank correlation coefficients for all possible pairs of columns of a matrix. Missing values are deleted in pairs rather than deleting all rows of x having any missing variables. Ranks are computed using efficient algorithms, using midranks for ties.<br /> -- R Documentation / rcorr {Hmisc}</p>
</blockquote>
<pre class="sourceCode R"><code class="sourceCode r">d &lt;-<span class="st"> </span>mtcars
cormatrix =<span class="st"> </span><span class="kw">rcorr</span>(<span class="kw">as.matrix</span>(d), <span class="dt">type=</span><span class="st">&#39;spearman&#39;</span>)</code></pre>
<table>
<caption>Table 3: Resulting correlation matrix - correlation coefficients (cormatrix$r)</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">disp</th>
<th style="text-align: right;">hp</th>
<th style="text-align: right;">drat</th>
<th style="text-align: right;">wt</th>
<th style="text-align: right;">qsec</th>
<th style="text-align: right;">vs</th>
<th style="text-align: right;">am</th>
<th style="text-align: right;">gear</th>
<th style="text-align: right;">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mpg</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">-0.91</td>
<td style="text-align: right;">-0.91</td>
<td style="text-align: right;">-0.89</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">-0.89</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">-0.66</td>
</tr>
<tr class="even">
<td style="text-align: left;">cyl</td>
<td style="text-align: right;">-0.91</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">-0.68</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">-0.57</td>
<td style="text-align: right;">-0.81</td>
<td style="text-align: right;">-0.52</td>
<td style="text-align: right;">-0.56</td>
<td style="text-align: right;">0.58</td>
</tr>
<tr class="odd">
<td style="text-align: left;">disp</td>
<td style="text-align: right;">-0.91</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">-0.68</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">-0.46</td>
<td style="text-align: right;">-0.72</td>
<td style="text-align: right;">-0.62</td>
<td style="text-align: right;">-0.59</td>
<td style="text-align: right;">0.54</td>
</tr>
<tr class="even">
<td style="text-align: left;">hp</td>
<td style="text-align: right;">-0.89</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">-0.52</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">-0.67</td>
<td style="text-align: right;">-0.75</td>
<td style="text-align: right;">-0.36</td>
<td style="text-align: right;">-0.33</td>
<td style="text-align: right;">0.73</td>
</tr>
<tr class="odd">
<td style="text-align: left;">drat</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">-0.68</td>
<td style="text-align: right;">-0.68</td>
<td style="text-align: right;">-0.52</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">-0.75</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">-0.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">wt</td>
<td style="text-align: right;">-0.89</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">-0.75</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">-0.23</td>
<td style="text-align: right;">-0.59</td>
<td style="text-align: right;">-0.74</td>
<td style="text-align: right;">-0.68</td>
<td style="text-align: right;">0.50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">qsec</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">-0.57</td>
<td style="text-align: right;">-0.46</td>
<td style="text-align: right;">-0.67</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">-0.23</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">-0.20</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">-0.66</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">-0.81</td>
<td style="text-align: right;">-0.72</td>
<td style="text-align: right;">-0.75</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">-0.59</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">-0.63</td>
</tr>
<tr class="odd">
<td style="text-align: left;">am</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">-0.52</td>
<td style="text-align: right;">-0.62</td>
<td style="text-align: right;">-0.36</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">-0.74</td>
<td style="text-align: right;">-0.20</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">-0.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">gear</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">-0.56</td>
<td style="text-align: right;">-0.59</td>
<td style="text-align: right;">-0.33</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">-0.68</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">carb</td>
<td style="text-align: right;">-0.66</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">-0.66</td>
<td style="text-align: right;">-0.63</td>
<td style="text-align: right;">-0.06</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>
<table>
<caption>Table 4: Resulting correlation matrix - significance levels (cormatrix$P)</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">disp</th>
<th style="text-align: right;">hp</th>
<th style="text-align: right;">drat</th>
<th style="text-align: right;">wt</th>
<th style="text-align: right;">qsec</th>
<th style="text-align: right;">vs</th>
<th style="text-align: right;">am</th>
<th style="text-align: right;">gear</th>
<th style="text-align: right;">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mpg</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">cyl</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">disp</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">hp</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">drat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.49</td>
</tr>
<tr class="even">
<td style="text-align: left;">wt</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">qsec</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">am</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.73</td>
</tr>
<tr class="even">
<td style="text-align: left;">gear</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.53</td>
</tr>
<tr class="odd">
<td style="text-align: left;">carb</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
<p>The correlation coefficients can be plotted using a heat map representation. <a href="http://ggplot2.org">ggplot2</a> provides the <a href="http://docs.ggplot2.org/current/geom_tile.html">geom_tile</a> geometric object for this purpose. In order to plot the correlation matrix we need to <a href="http://www.wekaleamstudios.co.uk/posts/melt/">meld</a> the data frame first.</p>
<pre class="sourceCode R"><code class="sourceCode r">cordata =<span class="st"> </span><span class="kw">melt</span>(cormatrix$r)
<span class="kw">ggplot</span>(cordata, <span class="kw">aes</span>(<span class="dt">x=</span>Var1, <span class="dt">y=</span>Var2, <span class="dt">fill=</span>value)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_tile</span>() +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>)</code></pre>
<figure>
<img src="http://proven-inconclusive.com/images/R/spearman_correlation_heatmap_mtcars_bare.svg" alt="Figure 2: Spearman correlation heat map based on the mtcars data set. No information about significance levels is included" /><figcaption>Figure 2: Spearman correlation heat map based on the mtcars data set. No information about significance levels is included</figcaption>
</figure>
<p>Figure 2 shows the resulting heat map, plotted by ggplot2. However, some key data is missing. There is no information about the significance levels nor does the plot include the numeric values of Spearman's rho. In order to efficiently use the little space per tile, I wrote a little function (&quot;abbreviateSTR&quot;) which abbreviates the values. The resulting strings are stored in a label column. This column can then be plotted onto the corresponding tile. To further enhance the distinction between significant (P &gt; 0.05) and insignificant correlations, a red, semi transparent, ”X” is being overlaid onto insignificant tiles. The resulting plot is shown in figure 1.</p>
<h3 id="conclusion">Conclusion</h3>
<p>By using the non-parametric Spearman algorithm it is possible to create a preliminary overview of the correlations within a data set. This information can be plotted utilizing a heat map representation in conjunction with significance levels as well as numeric values of Spearman's rho. The resulting plot is a comprehensible representation of the data set, which allows quick identification of significant correlations.</p>
<p>Looking at the heat map, one could get the impression that the gross horsepower has a strong negative correlation (r ≈ -0.89, P &lt; 0.01) with the gasoline consumption. Who would have thought?</p>
<h3 id="complete-r-script">Complete R Script</h3>
<pre class="sourceCode R"><code class="sourceCode r"><span class="co">#!/usr/bin/env Rscript</span>

<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(reshape2)
<span class="kw">library</span>(Hmisc)
<span class="kw">library</span>(stats)

abbreviateSTR &lt;-<span class="st"> </span>function(value, prefix){  <span class="co"># format string more concisely</span>
  lst =<span class="st"> </span><span class="kw">c</span>()
  for (item in value) {
    if (<span class="kw">is.nan</span>(item) ||<span class="st"> </span><span class="kw">is.na</span>(item)) { <span class="co"># if item is NaN return empty string</span>
      lst &lt;-<span class="st"> </span><span class="kw">c</span>(lst, <span class="st">&#39;&#39;</span>)
      next
    }
    item &lt;-<span class="st"> </span><span class="kw">round</span>(item, <span class="dv">2</span>) <span class="co"># round to two digits</span>
    if (item ==<span class="st"> </span><span class="dv">0</span>) { <span class="co"># if rounding results in 0 clarify</span>
      item =<span class="st"> &#39;&lt;.01&#39;</span>
    }
    item &lt;-<span class="st"> </span><span class="kw">as.character</span>(item)
    item &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;(^[0])+&quot;</span>, <span class="st">&quot;&quot;</span>, item)    <span class="co"># remove leading 0: 0.05 -&gt; .05</span>
    item &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;(^-[0])+&quot;</span>, <span class="st">&quot;-&quot;</span>, item)  <span class="co"># remove leading -0: -0.05 -&gt; -.05</span>
    lst &lt;-<span class="st"> </span><span class="kw">c</span>(lst, <span class="kw">paste</span>(prefix, item, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))
  }
  <span class="kw">return</span>(lst)
}

d &lt;-<span class="st"> </span>mtcars

cormatrix =<span class="st"> </span><span class="kw">rcorr</span>(<span class="kw">as.matrix</span>(d), <span class="dt">type=</span><span class="st">&#39;spearman&#39;</span>)
cordata =<span class="st"> </span><span class="kw">melt</span>(cormatrix$r)
cordata$labelr =<span class="st"> </span><span class="kw">abbreviateSTR</span>(<span class="kw">melt</span>(cormatrix$r)$value, <span class="st">&#39;r&#39;</span>)
cordata$labelP =<span class="st"> </span><span class="kw">abbreviateSTR</span>(<span class="kw">melt</span>(cormatrix$P)$value, <span class="st">&#39;P&#39;</span>)
cordata$label =<span class="st"> </span><span class="kw">paste</span>(cordata$labelr, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, 
                      cordata$labelP, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
cordata$strike =<span class="st"> &quot;&quot;</span>
cordata$strike[cormatrix$P &gt;<span class="st"> </span><span class="fl">0.05</span>] =<span class="st"> &quot;X&quot;</span>

txtsize &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&#39;din&#39;</span>)[<span class="dv">2</span>] /<span class="st"> </span><span class="dv">2</span>
<span class="kw">ggplot</span>(cordata, <span class="kw">aes</span>(<span class="dt">x=</span>Var1, <span class="dt">y=</span>Var2, <span class="dt">fill=</span>value)) +<span class="st"> </span><span class="kw">geom_tile</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">hjust=</span><span class="ot">TRUE</span>)) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">label=</span>cordata$label, <span class="dt">size=</span>txtsize) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">label=</span>cordata$strike, <span class="dt">size=</span>txtsize *<span class="st"> </span><span class="dv">4</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.4</span>)</code></pre>
<div class="references">

</div>

            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'proven-inconclusive'; // required: replace example with your forum shortname

                    var disqus_identifier = 'spearman_correlation_heat_map_with_correlation_coefficient_and_significance_in_r';
                var disqus_url = 'http://proven-inconclusive.com/blog/spearman_correlation_heat_map_with_correlation_coefficient_and_significance_in_r.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="mailto:hbwinther@metalabs.de"><i class="fa fa-email-square fa-lg"></i> EMail</a></li>
                <li class="list-group-item"><a href="http://twitter.com/hbwinther"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                <li class="list-group-item"><a href="http://github.com/liob/"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
                <li class="list-group-item"><a href="https://bitbucket.org/hbwinther"><i class="fa fa-bitbucket-square fa-lg"></i> BitBucket</a></li>
                <li class="list-group-item"><a href="https://www.facebook.com/hbwinther"><i class="fa fa-facebook-square fa-lg"></i> Facebook</a></li>
                <li class="list-group-item"><a href="http://www.linkedin.com/in/hbwinther"><i class="fa fa-linkedin-square fa-lg"></i> Linkedin</a></li>
                <li class="list-group-item"><a href="http://proven-inconclusive.com/feeds/all.atom.xml"><i class="fa fa-rss-square fa-lg"></i> RSS</a></li>
              </ul>
            </li>

            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                <ul class="list-group" id="recentposts">
                    <li class="list-group-item">
                        <a href="http://proven-inconclusive.com/blog/machine_learning_methods_to_identify_important_variables.html">
                            QuickTip: Utilizing Machine Learning Methods to Identify Important Variables
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://proven-inconclusive.com/blog/spearman_correlation_heat_map_with_correlation_coefficient_and_significance_in_r.html">
                            Spearman Correlation Heat Map with Correlation Coefficients and Significance Levels in R
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://proven-inconclusive.com/blog/scientific_blogging_with_pelican_and_pandoc.html">
                            Scientific Blogging with Pelican and Pandoc
                        </a>
                    </li>
                </ul>
            </li>


            <li class="list-group-item"><a href="http://proven-inconclusive.com/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                    <li class="list-group-item tag-1">
                        <a href="http://proven-inconclusive.com/tags/scientific-writing.html">
                            "scientific writing"
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://proven-inconclusive.com/tags/r.html">
                            "R"
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://proven-inconclusive.com/tags/quicktip.html">
                            "QuickTip"
                        </a>
                    </li>
                </ul>
            </li>

    <li class="list-group-item"><h4><i class="fa fa-twitter fa-lg"></i><span class="icon-label">Latest Tweets</span></h4></li>
    <div id="twitter_timeline">
        <a class="twitter-timeline" data-chrome="noheader" href="https://twitter.com/hbwinther" data-widget-id="481049923681406977">Tweets by hbwinther</a>
    </div>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.r-bloggers.com" target="_blank">
                R-bloggers
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://abstractnonsense.de" target="_blank">
                Christian Hundt
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://www.randalolson.com/blog/" target="_blank">
                Randy Olson
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2015 Hinrich B. Winther
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://proven-inconclusive.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://proven-inconclusive.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://proven-inconclusive.com/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'proven-inconclusive'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Piwik -->
    <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(["trackPageView"]);
        _paq.push(["enableLinkTracking"]);

        (function() {
            var u=(("https:" == document.location.protocol) ? "https://tools.metalabs.de/piwik/" : "http://tools.metalabs.de/piwik/");
            _paq.push(["setTrackerUrl", u+"piwik.php"]);
            _paq.push(["setSiteId", "3"]);
            var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
            g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Piwik Code -->
</body>
</html>